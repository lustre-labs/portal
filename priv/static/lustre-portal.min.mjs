function L(n,e,t){return n?e:t()}var r=class{withFields(e){let t=Object.keys(this).map(o=>o in e?e[o]:this[o]);return new this.constructor(...t)}};var A=class n extends r{static isResult(e){return e instanceof n}},i=class extends A{constructor(e){super(),this[0]=e}isOk(){return!0}},s=class extends A{constructor(e){super(),this[0]=e}isOk(){return!1}};var ct=5,K=Math.pow(2,ct),Br=K-1,Or=K/2,Nr=K/4;var ge=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),Yr=new RegExp(`^[${ge}]*`),Zr=new RegExp(`[${ge}]*$`);var B=()=>globalThis?.document;var zt=!!globalThis.HTMLElement?.prototype?.moveBefore;var ur=Symbol("lustre");var Ke=n=>{for(;n;){if(n[ur])return!0;n=n.parentNode}return!1};var S=()=>!!B(),ce=n=>S()&&customElements.get(n);var I=class extends r{constructor(e){super(),this.name=e}};var C=class extends r{};function tt(n){customElements.define(n,me)}var _e=Symbol("portals"),me=class extends HTMLElement{static observedAttributes=["target","root"];#e=null;#t=[];constructor(){super(),this.#e=this.#o(),this.#t=[...super.childNodes]}connectedCallback(){this.style.display="none",this.#i(this.#l())}disconnectedCallback(){this.#n()}connectedMoveCallback(){if(!this.#e)return;let e=this.#e[_e]??=[],t=et(e,this),o=Ze(e,this);if(t!==o){let c=e[o+1]?.firstChild??null;for(let x of this.#t)this.#e.moveBefore(x,c)}}attributeChangedCallback(e,t,o){if(t===o)return;let c=this.#o();this.#e!==c&&this.#s(c)}get target(){return super.getAttribute("target")}set target(e){if(e instanceof HTMLElement){let t=this.#u(e);t?this.#s(t):(this.#n(),this.#e=null)}else super.setAttribute("target",typeof e=="string"?e:"")}get root(){return super.getAttribute("root")}set root(e){super.setAttribute("root",e!=="relative"&&e!=="document"?"document":e)}#n(){return this.#e&&et(this.#e[_e],this),this.#l()}#i(e){if(!this.isConnected||!this.#e)return;let t=this.#e[_e]??=[],o=Ze(t,this),c=t[o+1]?.firstChild??null;this.#e.insertBefore(e,c)}#s(e){if(this.isConnected){let t=this.#n();this.#e=e,this.#i(t)}else this.#e=e}#o(){if(!this.target)return this.#r(rt,"The target attribute cannot be empty.");let e=this.root==="relative"?this.getRootNode():document,t=null;try{t=e.querySelector(this.target)}catch{return this.#r(nt,`The target "${this.target}" is not a valid query selector.`,{selector:this.target})}return this.#u(t)}#u(e){if(!e)return this.#r(it,`No element matching "${this.target}".`,{selector:this.target});if(e instanceof HTMLIFrameElement){let t=e.contentDocument?.body;return t||this.#r(ot,"Only same-origin iframes can be targeted.")}return Ke(e)?this.#r(st,`The element matching "${this.target}" must not be owned by Lustre.`):e}#r(e,t="",o={}){return this.dispatchEvent(new CustomEvent("error",{detail:{tag:e,message:t,...o}})),null}#l(){let e=document.createDocumentFragment();for(let t of this.#t)e.appendChild(t);return e}#a(e,t,o){let c=e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?[...e.childNodes]:[e],x=this.#t.indexOf(e),lt=o(e,t??this.lastChild?.nextSibling??null);x>=0&&this.#t.splice(x,1);let at=t?this.#t.indexOf(t):this.#t.length;return this.#t.splice(at,0,...c),lt}get childNodes(){return this.#t}get firstChild(){return this.#t[0]}get lastChild(){return this.#t[this.#t.length-1]}moveBefore(e,t){return this.#a(e,t,(o,c)=>{this.#e?.moveBefore(o,c)})}insertBefore(e,t){return this.#a(e,t,(o,c)=>{this.#e?.insertBefore(o,c)})}removeChild(e){let t=this.#t.indexOf(e);this.#e?.removeChild(e),this.#t.splice(t,1)}};function kr(n,e){let t=0,o=n.length-1;for(;t<=o;){let c=(t+o)/2|0,x=e.compareDocumentPosition(n[c]);if(x&Node.DOCUMENT_POSITION_FOLLOWING)o=c-1;else if(x&Node.DOCUMENT_POSITION_PRECEDING)t=c+1;else return c}return t}function Ze(n,e){let t=kr(n,e);return n[t]!==e&&n.splice(t,0,e),t}function et(n,e){let t=n.indexOf(e);return t>=0&&n.splice(t,1),t}var he="lustre-portal";function ut(){return L(!S(),new s(new C),()=>L(ce(he),new s(new I(he)),()=>new i(tt(he))))}var rt="missing-selector",nt="invalid-selector",it="target-not-found",st="target-inside-lustre";var ot="target-is-cross-origin-iframe";ut();
