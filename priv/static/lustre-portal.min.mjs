function L(c,e,t){return c?e:t()}var r=class{withFields(e){let t=Object.keys(this).map(o=>o in e?e[o]:this[o]);return new this.constructor(...t)}};var A=class c extends r{static isResult(e){return e instanceof c}},n=class extends A{constructor(e){super(),this[0]=e}isOk(){return!0}},i=class extends A{constructor(e){super(),this[0]=e}isOk(){return!1}};var ft=5,K=Math.pow(2,ft),Sr=K-1,Cr=K/2,Ar=K/4;var ve=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),Xr=new RegExp(`^[${ve}]*`),Jr=new RegExp(`[${ve}]*$`);var z=()=>globalThis?.document;var Ot=!!globalThis.HTMLElement?.prototype?.moveBefore;var ir=Symbol("lustre");var Ye=c=>!!c[ir];var S=()=>!!z(),fe=c=>S()&&customElements.get(c);var I=class extends r{constructor(e){super(),this.name=e}};var C=class extends r{};function et(c){customElements.define(c,_e)}var _=Symbol("lustre-portal"),_e=class c extends HTMLElement{static observedAttributes=["target","root"];#t=null;#e=[];constructor(){super(),this.#t=this.#i(),this.#e=[...super.childNodes],this.$childNodes.forEach(e=>this.#u(e))}connectedCallback(){this.style.display="none",this.#n()}disconnectedCallback(){this.#n()}connectedMoveCallback(){}attributeChangedCallback(e,t,o){t!==o&&(this.targetElement=this.#i())}get targetElement(){return this.#t}set targetElement(e){e!==this.#t&&(this.#t=this.#s(e),this.#n())}get target(){return super.getAttribute("target")??""}set target(e){e instanceof HTMLElement?this.targetElement=e:super.setAttribute("target",typeof e=="string"?e:"")}get root(){return super.getAttribute("root")}set root(e){super.setAttribute("root",e!=="relative"&&e!=="document"?"document":e)}#n(){let e=document.createDocumentFragment();for(let t of this.#e)e.appendChild(t);this.isConnected&&this.#t?.insertBefore(e,null)}#i(){if(!this.target)return this.#r(tt,"The target attribute cannot be empty.");let e=this.root==="relative"?this.getRootNode():document,t=null;try{t=e.querySelector(this.target)}catch{return this.#r(rt,`The target "${this.target}" is not a valid query selector.`)}return this.#s(t)}#s(e){if(!e)return this.#r(nt,`No element matching "${this.target}".`);if(e instanceof HTMLIFrameElement){let t=e.contentDocument?.body;return t||this.#r(st,"Only same-origin iframes can be targeted.")}return e instanceof c?this.#r(ot,`The element matching "${this.target}" must not be another portal.`):Ye(e)?this.#r(it,`The element matching "${this.target}" must not be owned by Lustre.`):e}#r(e,t="",o={}){return this.dispatchEvent(new CustomEvent("error",{detail:{tag:e,message:t,selector:this.target,...o}})),null}#o(e,t,o){let w=e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?[...e.childNodes]:[e],xe=this.#e.indexOf(e),lt=o(e,t??this.lastChild?.nextSibling??null);w.forEach(ct=>this.#u(ct)),xe>=0&&this.#e.splice(xe,1);let at=t?this.#e.indexOf(t):this.#e.length;return this.#e.splice(at,0,...w),lt}#u(e){e.nodeType===Node.ELEMENT_NODE&&(e[_]??={},e[_].provider||(e[_].provider=t=>{t.stopImmediatePropagation();let o=new Event(t.type,{bubbles:t.bubbles,composed:t.composed});o.context=t.context,o.subscribe=t.subscribe,o.callback=t.callback,this.dispatchEvent(o)},e.addEventListener("context-request",e[_].provider)))}#l(e){e[_]&&e[_].provider&&(e.removeEventListener("context-request",e[_].provider),e[_].provider=null)}get childNodes(){return this.#e}get firstChild(){return this.#e[0]}get lastChild(){return this.#e[this.#e.length-1]}moveBefore(e,t){return this.#o(e,t,(o,w)=>{this.#t?.moveBefore(o,w)})}insertBefore(e,t){return this.#o(e,t,(o,w)=>{this.#t?.insertBefore(o,w)})}removeChild(e){let t=this.#e.indexOf(e);this.#t?.removeChild(e),this.#l(e),this.#e.splice(t,1)}};var he="lustre-portal";function ut(){return L(!S(),new i(new C),()=>L(fe(he),new i(new I(he)),()=>new n(et(he))))}var tt="missing-selector",rt="invalid-selector",nt="target-not-found",it="target-inside-lustre",st="target-is-cross-origin-iframe",ot="target-is-portal";ut();
