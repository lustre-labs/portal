function U(n,e,t){return n?e:t()}var r=class{withFields(e){let t=Object.keys(this).map(o=>o in e?e[o]:this[o]);return new this.constructor(...t)}};var A=class n extends r{static isResult(e){return e instanceof n}},i=class extends A{constructor(e){super(),this[0]=e}isOk(){return!0}},s=class extends A{constructor(e){super(),this[0]=e}isOk(){return!1}};var pt=5,X=Math.pow(2,pt),zr=X-1,Tr=X/2,Or=X/4;var ge=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),Qr=new RegExp(`^[${ge}]*`),en=new RegExp(`[${ge}]*$`);var T=()=>globalThis?.document;var Nt=!!globalThis.HTMLElement?.prototype?.moveBefore;var ur=Symbol("lustre");var Ze=n=>!!n[ur];var S=()=>!!T(),ce=n=>S()&&customElements.get(n);var I=class extends r{constructor(e){super(),this.name=e}};var C=class extends r{};function rt(n){customElements.define(n,me)}var he=Symbol("portals"),me=class n extends HTMLElement{static observedAttributes=["target","root"];#e=null;#t=[];constructor(){super(),this.#e=this.#o(),this.#t=[...super.childNodes]}connectedCallback(){this.style.display="none",this.#i(this.#a())}disconnectedCallback(){this.#n()}connectedMoveCallback(){if(!this.#e)return;let e=this.#e[he]??=[],t=tt(e,this),o=et(e,this);if(t!==o){let l=e[o+1]?.firstChild??null;for(let x of this.#t)this.#e.moveBefore(x,l)}}attributeChangedCallback(e,t,o){if(t===o)return;let l=this.#o();this.#e!==l&&this.#s(l)}get target(){return super.getAttribute("target")??""}set target(e){if(e instanceof HTMLElement){let t=this.#u(e);t?this.#s(t):(this.#n(),this.#e=null)}else super.setAttribute("target",typeof e=="string"?e:"")}get root(){return super.getAttribute("root")}set root(e){super.setAttribute("root",e!=="relative"&&e!=="document"?"document":e)}#n(){return this.#e&&tt(this.#e[he],this),this.#a()}#i(e){if(!this.isConnected||!this.#e)return;let t=this.#e[he]??=[],o=et(t,this),l=t[o+1]?.firstChild??null;this.#e.insertBefore(e,l)}#s(e){if(this.isConnected){let t=this.#n();this.#e=e,this.#i(t)}else this.#e=e}#o(){if(!this.target)return this.#r(nt,"The target attribute cannot be empty.");let e=this.root==="relative"?this.getRootNode():document,t=null;try{t=e.querySelector(this.target)}catch{return this.#r(it,`The target "${this.target}" is not a valid query selector.`)}return this.#u(t)}#u(e){if(!e)return this.#r(st,`No element matching "${this.target}".`);if(e instanceof HTMLIFrameElement){let t=e.contentDocument?.body;return t||this.#r(ut,"Only same-origin iframes can be targeted.")}return e instanceof n?this.#r(at,`The element matching "${this.target}" must not be another portal.`):Ze(e)?this.#r(ot,`The element matching "${this.target}" must not be owned by Lustre.`):e}#r(e,t="",o={}){return this.dispatchEvent(new CustomEvent("error",{detail:{tag:e,message:t,selector:this.target,...o}})),null}#a(){let e=document.createDocumentFragment();for(let t of this.#t)e.appendChild(t);return e}#l(e,t,o){let l=e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?[...e.childNodes]:[e],x=this.#t.indexOf(e),ct=o(e,t??this.lastChild?.nextSibling??null);x>=0&&this.#t.splice(x,1);let ft=t?this.#t.indexOf(t):this.#t.length;return this.#t.splice(ft,0,...l),ct}get childNodes(){return this.#t}get firstChild(){return this.#t[0]}get lastChild(){return this.#t[this.#t.length-1]}moveBefore(e,t){return this.#l(e,t,(o,l)=>{this.#e?.moveBefore(o,l)})}insertBefore(e,t){return this.#l(e,t,(o,l)=>{this.#e?.insertBefore(o,l)})}removeChild(e){let t=this.#t.indexOf(e);this.#e?.removeChild(e),this.#t.splice(t,1)}};function kr(n,e){let t=0,o=n.length-1;for(;t<=o;){let l=(t+o)/2|0,x=e.compareDocumentPosition(n[l]);if(x&Node.DOCUMENT_POSITION_FOLLOWING)o=l-1;else if(x&Node.DOCUMENT_POSITION_PRECEDING)t=l+1;else return l}return t}function et(n,e){let t=kr(n,e);return n[t]!==e&&n.splice(t,0,e),t}function tt(n,e){let t=n.indexOf(e);return t>=0&&n.splice(t,1),t}var _e="lustre-portal";function lt(){return U(!S(),new s(new C),()=>U(ce(_e),new s(new I(_e)),()=>new i(rt(_e))))}var nt="missing-selector",it="invalid-selector",st="target-not-found",ot="target-inside-lustre",ut="target-is-cross-origin-iframe",at="target-is-portal";lt();
