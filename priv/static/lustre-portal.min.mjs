function I(o,e,t){return o?e:t()}var r=class{withFields(e){let t=Object.keys(this).map(u=>u in e?e[u]:this[u]);return new this.constructor(...t)}};var A=class o extends r{static isResult(e){return e instanceof o}},n=class extends A{constructor(e){super(),this[0]=e}isOk(){return!0}},i=class extends A{constructor(e){super(),this[0]=e}isOk(){return!1}};var ct=5,X=Math.pow(2,ct),Tr=X-1,Br=X/2,Or=X/4;var ge=[" ","	",`
`,"\v","\f","\r","\x85","\u2028","\u2029"].join(""),Yr=new RegExp(`^[${ge}]*`),Qr=new RegExp(`[${ge}]*$`);var B=()=>globalThis?.document;var Nt=!!globalThis.HTMLElement?.prototype?.moveBefore;var ur=Symbol("lustre");var Xe=o=>{for(;o;){if(o[ur])return!0;o=o.parentNode}return!1};var S=()=>!!B(),ce=o=>S()&&customElements.get(o);var L=class extends r{constructor(e){super(),this.name=e}};var C=class extends r{};function Ze(o){customElements.define(o,_e)}var h=Symbol("lustre-portal"),_e=class o extends HTMLElement{static observedAttributes=["target","root"];#t=null;#e=[];constructor(){super(),this.#t=this.#i(),this.#e=[...super.childNodes],this.#e.forEach(e=>this.#u(e))}connectedCallback(){this.style.display="none",this.#n()}disconnectedCallback(){this.#n()}connectedMoveCallback(){}attributeChangedCallback(e,t,u){t!==u&&(this.targetElement=this.#i())}get targetElement(){return this.#t}set targetElement(e){e!==this.#t&&(this.#t=this.#s(e),this.#n())}get target(){return super.getAttribute("target")??""}set target(e){e instanceof HTMLElement?this.targetElement=e:super.setAttribute("target",typeof e=="string"?e:"")}get root(){return super.getAttribute("root")}set root(e){super.setAttribute("root",e!=="relative"&&e!=="document"?"document":e)}#n(){let e=document.createDocumentFragment();for(let t of this.#e)e.appendChild(t);this.isConnected&&this.#t?.insertBefore(e,null)}#i(){if(!this.target)return this.#r(et,"The target attribute cannot be empty.");let e=this.root==="relative"?this.getRootNode():document,t=null;try{t=e.querySelector(this.target)}catch{return this.#r(tt,`The target "${this.target}" is not a valid query selector.`)}return this.#s(t)}#s(e){if(!e)return this.#r(rt,`No element matching "${this.target}".`);if(e instanceof HTMLIFrameElement){let t=e.contentDocument?.body;return t||this.#r(it,"Only same-origin iframes can be targeted.")}return e instanceof o?this.#r(st,`The element matching "${this.target}" must not be another portal.`):Xe(e)?this.#r(nt,`The element matching "${this.target}" must not be owned by Lustre.`):e}#r(e,t="",u={}){return this.dispatchEvent(new CustomEvent("error",{detail:{tag:e,message:t,selector:this.target,...u}})),null}#o(e,t,u){let b=e.nodeType===Node.DOCUMENT_FRAGMENT_NODE?[...e.childNodes]:[e],he=this.#e.indexOf(e),ut=u(e,t??this.lastChild?.nextSibling??null);b.forEach(at=>this.#u(at)),he>=0&&this.#e.splice(he,1);let lt=t?this.#e.indexOf(t):this.#e.length;return this.#e.splice(lt,0,...b),ut}#u(e){e.nodeType===Node.ELEMENT_NODE&&(e[h]??={},e[h].provider||(e[h].provider=t=>{t.stopImmediatePropagation();let u=new Event(t.type,{bubbles:t.bubbles,composed:t.composed});u.context=t.context,u.subscribe=t.subscribe,u.callback=t.callback,this.dispatchEvent(u)},e.addEventListener("context-request",e[h].provider)))}#l(e){e[h]&&e[h].provider&&(e.removeEventListener("context-request",e[h].provider),e[h].provider=null)}get childNodes(){return this.#e}get firstChild(){return this.#e[0]}get lastChild(){return this.#e[this.#e.length-1]}moveBefore(e,t){return this.#o(e,t,(u,b)=>{this.#t?.moveBefore(u,b)})}insertBefore(e,t){return this.#o(e,t,(u,b)=>{this.#t?.insertBefore(u,b)})}removeChild(e){let t=this.#e.indexOf(e);this.#t?.removeChild(e),this.#l(e),this.#e.splice(t,1)}};var me="lustre-portal";function ot(){return I(!S(),new i(new C),()=>I(ce(me),new i(new L(me)),()=>new n(Ze(me))))}var et="missing-selector",tt="invalid-selector",rt="target-not-found",nt="target-inside-lustre",it="target-is-cross-origin-iframe",st="target-is-portal";ot();
